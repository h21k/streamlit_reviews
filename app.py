import streamlit as st
import requests
import json

in_review = [
  {
    "review_id": 4164,
    "review_description": "CABG vs stents (early vs late generation) vs medications",
    "included_pmids": ["24308072","23010084","21982668","24591399","25445101","21975782",
                       "24212107","24704465","22447805","24842560","23152364","24459196",
                       "22407425","24723467","24211507","21764670","21171912","23784750",
                       "24345688","25097568","21389717","23726179","24846507","24454326",
                       "24622417","25662779","22030707","24746647","24240936","25224547",
                       "24893748","24296767","21824922","23782856","21570728","22405674",
                       "21167508","24704466","20630453","22529227","23926119","25378023",
                       "24244335","21791671","22422445","23739937","26025863","24844284",
                       "24890171","24560821","20412967","22371919","24814900","24281230",
                       "24355112","24611133","21221607","22872052","23993323","20824754",
                       "23490029","24373711","22518037","24478247","20381655","23078911",
                       "20102892","24755335","22907763","22364383","24342760","20494658",
                       "25185569","22877423","25759103","20231568","24775802","25100715",
                       "21896624","24899233","20868861","24170643","24939927","24993986",
                       "22513345","23756410","21947626","24657881","21939824","23428214",
                       "23325526","22872053","23123552","21478627","20562080","22205918",
                       "25467373","25127976","24958153","22116195","24613365","21328679",
                       "24007976","24196498","24529148","25411635","24659172","20965464",
                       "20549695","24801298"]
  },
  {
    "review_id": 2345,
    "review_description": "Calcium and cardiovascular disease",
    "included_pmids": ["25398967", "21505219", "23208074", "24114400", "22112804", "19221190",
                       "17309935", "24131320", "26440516", "20614474"]
  },
  {
    "review_id": 2045,
    "review_description": "Omega 3",
    "included_pmids": ["22894911", "22686415", "23835245", "16772624", "12571649", "2571009", "21561620", "22707560", "18779276", "18492834", "19397392", "22811376", "19593941", "20389249", "8540453", "12663273", "21115589", "24454276", "9665096", "15853118", "19002433", "24829493", "24528690", "20929341", "24553695", "16267249", "7852747", "23265344", "20451686", "23998969", "11997274", "5756076", "11451717", "21844082", "21215550", "25147070", "19748619", "25565485", "25226826", "15956633", "25122648", "16469978", "21060071", "24126178", "23656645", "8021472", "7759696", "21865334", "25185754", "12847992", "12847992", "24652053", "25394692", "24314359", "23725919", "18757090", "20938439", "24462043", "10189324", "17398308"]
  },
  {
    "review_id": 10184,
    "review_description": "Appendicitis",
    "included_pmids": ["14588157","17192450","23715771","18186378","12480851","17329682","20350244","17901913","11182396","22191292","17566826","22633722","22533576","15136349","10930484","12034928","15350578","11030676","18660395","19625549","19941671","21290005","17870498","18841382","20379739","14768141","10583282","11818109","8186313","9069134","11285968","8369940","17219281","12739123"]

  },
  {
    "review_id": 10181,
    "review_description": "Tympanostomy",
    "included_pmids": ["2070526", "11409855", "15231974", "15373863", "16093466", "2789777", "19819563", "1861917", "15126745", "11470387", "10944051", "21205368", "11309632", "11735817", "10459904", "12680834", "10969126", "16406076", "23120310", "12690269", "17229952", "20399511", "12897272", "16429748", "22443163", "1565550", "21397957", "19260880", "11124783"]
  },
  {
    "review_id": 10182,
    "review_description": "Decision Support Tools",
    "included_pmids": ["22394647", "20716619", "14678367", "23395006", "21715722", "22153756", "22608696", "23021156", "21237611", "9190093", "17876177", "22246148", "11958495", "20693148", "21442198", "22287534", "18299490", "14521639", "12790313", "15911190", "11206942", "11562929", "15834239", "15280342", "18218084", "22570252", "21212064", "19718941", "20876346", "18373146", "20609546", "24004815", "23835709", "22825933", "8998184", "20142594", "17954796", "20149953", "20179125", "21041538", "21565651", "16377604", "19819096", "16173330", "20619576", "17319855", "16911143", "15242468", "15951457", "11085838", "20432110", "17689600", "22753906", "20484090", "23159252", "19210013", "23148458", "16511899", "24421292", "20978060", "19025266", "8635032", "23896732", "16855125", "18573775", "15310772", "22882966", "19209172", "21299290", "10418541", "18760888", "15043176", "17333332", "18613319", "18618513", "16875796", "24274808", "15280341", "12697850", "23835818", "23357414", "23835817", "15824055", "22212453"]
  },
  {
    "review_id": 1,
    "review_description": "Basal cell carcinoma of the skin",
    "included_pmids": ["15606733", "22511036", "22385074", "11298545", "23566745", "11069453", "26985197", "23190903", "23190904", "23190905", "22738399", "24139468", "23725586", "26589877", "26589878", "19588534", "25913533", "14725659", "16865869", "17451581", "11312429", "25981810", "8996264",
                        "8977678", "16785375", "18717680", "19010733", "1430394", "16713457", "14732655", "12653747", "25047438", "15888150", "12224978", "20546215", "16393600", "12452875", "18624836", "10940063", "26157307", "298425", "8708151", "23683751", "9218740", "18693158",
                        "24332516", "17573890", "10570388", "27067393", "19018814", "25899562", "26551044", "2229497", "2107219", "2383027", "17610993", "20064185", "21242584", "12196749", "15097956", "24903544", "3514075", "24102369", "12224977", "22145798"]
  }
]

number1 = 11000101

st.title("Automated Evidence Updates")
st.subheader("v01 uncached")


url = "https://trialstreamer-api.robotreviewer.net"
api_key = "ZJ5J6mlWocHma4t9uun6MEDlRQaWtke#"

def query_trialstreamer(url, api_key, p, i, c, o, cui1, cui2):
    #url = url
    #api_key = api_key
    #query1 = {"terms":[{"field":str(pico),"cui":str(cui)}]}
    query1 = {"terms":[{"field":str(p),"cui":str(cui1)},{"field":str(i),"cui":str(cui2)}]}
    r = requests.post(url + "/picosearch", json=query1, headers={"api-key":api_key})
    result = r.json()
    filtered = [r for r in result if 'pmid' in r and r['pmid'] not in in_review]
    not_included = [r['num_randomized'] for r in filtered]
    return result, filtered, not_included

display, filtered, not_included = query_trialstreamer(url, api_key, "population", "interventions", "na", "na" ,"C0007117", "C0079850")

#with st.echo():
f"We found {len(display)} RCTs of 5FU surgery in Basal Cell Carcinoma"
f"The following {len(filtered)} RCTs were new from the original reviews."
for a in filtered:
    #print("Pubmed articles :", filtered[a])
    "https://pubmed.ncbi.nlm.nih.gov/" + str(a['pmid'])

if st.checkbox('display whole total search result'):
    with st.echo():
        display

with st.echo():
    not_included

with st.echo():
    [r['pmid'] for r in filtered]

if st.checkbox('display interventions not found in included studies'):
    with st.echo():
        "The following interventions were identfied which are not already included in reviews:"
        [r['interventions'] for r in filtered]

    with st.echo():
        filtered[0]


print("Hello My name is: ", number1)
